{% extends "base.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://surveyjs.azureedge.net/1.0.72/survey.css" type="text/css" rel="stylesheet"/>
    <style>
        form {
            max-width: 100%;
        }
    </style>
{% endblock stylesheets %}

{% block body_banner %}{% endblock body_banner %}
{% block body_main %}
    <div id="surveyContainer" class="container">
        <survey :survey="survey"></survey>
    </div>

{% endblock body_main %}
{% block javascripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.1.10/vue.min.js"></script>
    <script src="https://surveyjs.azureedge.net/1.0.72/survey.vue.min.js"></script>
    <script type="application/javascript">
        let surveyJSON = {{ form.data |json_encode|raw }};
        let survey = new Survey.Model(surveyJSON);

        {% if submission is defined %}
            survey.data = {{ submission.data|json_encode|raw }};
        {% endif %}


        function sendDataToServer(survey) {
            let resultAsString = JSON.stringify(survey.data);
            let url = "/submit/{{ form.id }}";
            {% if submission is defined %}
                url += "/"+{{ submission.id }};
            {% endif %}
            fetch(url,
                {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "POST",
                    body: resultAsString
                })
                .then(function (res) {
                    console.log(res)
                })
        }

        survey.onComplete.add(sendDataToServer);

        new Vue({el: '#surveyContainer', data: {survey: survey}});
    </script>
{% endblock javascripts %}